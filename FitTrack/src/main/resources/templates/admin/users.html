<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/_header :: head}"></head>

<body>
    <header th:replace="~{fragments/_header :: header}"></header>
    <main class="container">
        <div class="card slide-up">
            <div class="mb-4" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 class="mb-0">User Management</h1>
                    <p style="color: var(--text-muted);">Manage user accounts and permissions</p>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Roles</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="user : ${users}">
                            <td>
                                <span th:text="${user.username}"
                                    style="font-weight: 500; color: var(--text-main);"></span>
                            </td>
                            <td style="color: var(--text-muted);">
                                <span th:text="${user.email}"></span>
                            </td>
                            <td>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                    <span th:each="role : ${user.roles}" class="status-badge"
                                        style="background: rgba(34,197,94,0.1); color: var(--primary-color); border: 1px solid rgba(34,197,94,0.2);"
                                        th:text="${role.name}">
                                    </span>
                                </div>
                            </td>
                            <td>
                                <span th:if="${!user.isBlocked}" class="status-badge status-active">
                                    Active
                                </span>
                                <span th:if="${user.isBlocked}" class="status-badge"
                                    style="background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.2);">
                                    Blocked
                                </span>
                            </td>
                            <td>
                                <div style="display: flex; gap: 0.5rem;">
                                    <form th:if="${!user.isBlocked}"
                                        th:action="@{/admin/users/block/{id}(id=${user.id})}" method="post">
                                        <button type="submit" class="btn btn-danger"
                                            style="padding: 0.4rem 0.8rem; font-size: 0.85rem;"
                                            onclick="return confirm('Are you sure you want to block this user?');">
                                            Block
                                        </button>
                                    </form>
                                    <form th:if="${user.isBlocked}"
                                        th:action="@{/admin/users/unblock/{id}(id=${user.id})}" method="post">
                                        <button type="submit" class="btn btn-primary"
                                            style="padding: 0.4rem 0.8rem; font-size: 0.85rem;"
                                            onclick="return confirm('Are you sure you want to unblock this user?');">
                                            Unblock
                                        </button>
                                    </form>
                                    <form th:action="@{/admin/users/switch-role/{id}(id=${user.id})}" method="post">
                                        <input type="hidden" th:name="${_csrf.parameterName}"
                                            th:value="${_csrf.token}" />
                                        <button type="submit" class="btn btn-outline"
                                            style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                            Switch Role
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div th:if="${#lists.isEmpty(users)}"
                style="text-align: center; padding: 3rem 2rem; color: var(--text-muted);">
                <p style="margin: 0; font-size: 1.1rem;">No users found.</p>
            </div>
        </div>
    </main>

    <style>
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .table th {
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid var(--border-color);
            text-align: left;
            font-weight: 600;
            color: var(--text-main);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .table td {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover td {
            background-color: rgba(255, 255, 255, 0.02);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-block;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
    </style>
</body>

</html>